# 설계 문서: {기능명}

## 개요

이 설계 문서는 {기능명} 기능의 구현을 설명합니다. {설계 요약 1~2문장}

## 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                        {레이어1}                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │ {컴포넌트1}   │  │ {컴포넌트2}   │  │ {컴포넌트3}   │     │
│  └──────────────┘  └──────────────┘  └──────────────┘     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        {레이어2}                              │
│  ┌──────────────────┐  ┌──────────────────┐               │
│  │ {서비스1}         │  │ {서비스2}         │               │
│  └──────────────────┘  └──────────────────┘               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      데이터베이스 계층                         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                 │
│  │ {테이블1} │  │ {테이블2} │  │ {테이블3} │                 │
│  └──────────┘  └──────────┘  └──────────┘                 │
└─────────────────────────────────────────────────────────────┘
```

## 기존 자산 분석

### 재사용 가능한 자산

| 자산 | 위치 | 재사용 방식 |
|------|------|-------------|
| {컴포넌트/유틸} | `{경로}` | 그대로 사용 / 확장 |
| {기존 기능} | `{경로}` | 확장하여 사용 |

### 새로 생성이 필요한 부분

| 항목 | 근거 |
|------|------|
| {새 컴포넌트} | 기존에 없음 / 요구사항이 다름 |

## 컴포넌트 및 인터페이스

### 1. {컴포넌트/모듈 이름}

위치: `{파일 경로}`

```typescript
// 타입 정의
interface {TypeName} {
  id: string
  // ...
}

// 구현 예시
export function {functionName}({params}: {ParamType}): {ReturnType} {
  // 구현
}
```

### 2. {컴포넌트/모듈 이름}

위치: `{파일 경로}`

```typescript
// 구현 예시
```

## 데이터 모델

### 새로 추가되는 스키마

```prisma
model {ModelName} {
  id          BigInt   @id @default(dbgenerated("tsid_milli()"))
  
  // 필드들
  {fieldName} {Type}
  
  // 관계
  {relation}  {RelatedModel} @relation(...)
  
  createdAt   DateTime @default(now()) @db.Timestamptz()
  updatedAt   DateTime @updatedAt @db.Timestamptz()

  @@index([{indexField}])
}
```

### 기존 모델 수정 (확장)

```prisma
model {ExistingModel} {
  // 기존 필드 (유지)
  // ...
  
  // 새로 추가되는 필드
  {newField}  {Type}  @default({defaultValue})
  
  // 새로 추가되는 관계
  {newRelation} {NewModel}[]
}
```

## 마이그레이션 전략

### Phase 1: 새 스키마 추가 (기존 유지)

```sql
-- 새 테이블 생성
CREATE TABLE "{table_name}" (
  "id" BIGINT PRIMARY KEY DEFAULT tsid_milli(),
  -- 필드들
  "createdAt" TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 인덱스 추가
CREATE INDEX "{index_name}" ON "{table_name}"("{field}");
```

### Phase 2: 데이터 마이그레이션 (필요시)

```typescript
// 마이그레이션 스크립트
async function migrate() {
  // 기존 데이터를 새 구조로 변환
}
```

### Phase 3: 검증

- [ ] 새 기능 정상 동작 확인
- [ ] 기존 기능 영향 없음 확인

### Phase 4: 레거시 제거 (별도 작업, 선택)

- 별도 확인 후 진행
- 되돌릴 수 있는 기간 유지

---

## 작성 가이드

### 아키텍처 다이어그램
- ASCII 아트 사용 (마크다운 호환)
- 데이터 흐름 명확히 표시

### 코드 예시
- 실제 구현 가능한 수준
- 프로젝트 패턴 준수 (tRPC, Prisma 등)

### 마이그레이션
- 항상 되돌릴 수 있게 설계
- 레거시 제거는 검증 후 별도 Phase
